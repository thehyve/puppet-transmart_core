DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

<% case scope.lookupvar('::transmart_core::params::db_type') -%>
<% when 'postgresql' -%>
PGHOST=<%= scope.lookupvar('::transmart_core::params::db_host') %>
PGPORT=<%= scope.lookupvar('::transmart_core::params::db_port') %>
PGDATABASE=<%= scope.lookupvar('::transmart_core::params::db_name') %>
PGUSER=<%= scope.lookupvar('::transmart_core::params::db_user') %>
PGPASSWORD='<%= scope.lookupvar('::transmart_core::params::db_password') -%>'
PGVERSION=<%= scope.lookupvar('::postgresql::globals::version') %>

TABLESPACES=<%= scope.lookupvar('::postgresql::params::datadir') %>/../tablespaces/
PGSQL_BIN="/usr/bin/"

export PGHOST PGPORT PGDATABASE PGUSER PGPASSWORD TABLESPACES PGSQL_BIN PGVERSION
<% when 'oracle' -%>
ORAHOST=<%= scope.lookupvar('::transmart_core::params::db_host') %>
ORAPORT=<%= scope.lookupvar('::transmart_core::params::db_port') %>
ORASID=<%= scope.lookupvar('::transmart_core::params::db_name') %>
ORAUSER='<%= scope.lookupvar('::transmart_core::params::db_user') %>'
ORAPASSWORD='<%= scope.lookupvar('::transmart_core::params::db_password') -%>'
ORACLE_MANAGE_TABLESPACES=0
ORACLE=1

# some versions of transmart-data require this
export TABLESPACES=/bogus/

export ORAHOST ORAPORT ORASID ORAUSER ORAPASSWORD ORACLE_MANAGE_TABLESPACES ORACLE
<% else raise "Unknown database type. Check transmart_core::params::db_type" -%>
<% end -%>

TSUSER_HOME=<%= scope.lookupvar('::transmart_core::params::tsuser_home') %>

# {{{ DB user passwords
#     They default to the same as the username.
#     These are set when the database is created and they are used when
#     connecting to the database (e.g. for ETL).
#     You can reset passwords to the values specified here with:
#       make -C ddl/postgres/GLOBAL load_passwords
#       make -C ddl/oracle load_passwords
#     Depending on whether you're using oracle or postgres.
export BIOMART_USER_PWD=<%= scope.lookupvar('::transmart_core::params::biomart_user_password') %>
export TM_CZ_PWD=<%= scope.lookupvar('::transmart_core::params::tm_cz_user_password') %>
# }}}

# The Oracle driver uses the blocking random pool by default
# This is a bad idea because successive connections WILL exhaust the pool
# /dev/urandom is just as secure, provided it's been seeded already
export _JAVA_OPTIONS='-Djava.security.egd=file:///dev/urandom'

# If you need to proxy
# export _JAVA_OPTIONS="${_JAVA_OPTIONS} -Dhttp.proxyHost=$proxy_host -Dhttp.proxyPort=$proxy_port"

export PATH=$DIR/env:$PATH
export TSUSER_HOME

